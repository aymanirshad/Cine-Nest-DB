<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie Community - Browse Movies</title>
<link rel="stylesheet" href="movie.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

</head>
<body>


 <!-- Header / Navbar -->
    <header>
        <div class="container">
            <div class="logo">
                <img src="photos/logo.jpg" alt="Movie Community Logo">
                <span class="site-name">Cine Nest</span>
            </div>

            <nav>
                <ul class="nav-links">
                    <li><a href="home.html">Home</a></li>
                    <li class="dropdown">
                        <a href="#">Movies</a>
                        <ul class="dropdown-content">
                            <li><a href="movie.html">Browse Movies</a></li>
                            <li><a href="trending.html">Trending</a></li>
                            <li><a href="toprated.html">Top Rated</a></li>
                        </ul>
                    </li>


                    <li class="dropdown">
                        <a href="#">Genres</a>
                        <ul class="dropdown-content">
                            <li><a href="genre-action.html">Action</a></li>
                            <li><a href="genre-comedy.html">Comedy</a></li>
                            <li><a href="genre-horror.html">Horror</a></li>
                            <li><a href="genre-sci-fi.html">Sci-Fi</a></li>
                            <li><a href="genre-romance.html">Romance</a></li>
                        </ul>
                    </li>


                    <li class="dropdown">
                        <a href="#">Community</a>
                        <ul class="dropdown-content">
                            <li><a href="movie-discussion.html">Discussions</a></li>
                            <li><a href="events.html">Events</a></li>
                            <li><a href="friends.html">Friends</a></li>
                        </ul>
                    </li>
                    <li><a href="about.html">About</a></li>
                </ul>
            </nav>
            <div class="search-box">
                <!-- Added ID for JS -->
                <input type="text" placeholder="Search movies..." id="header-search-input">
                <button id="header-search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>

            <div class="auth-buttons" id="auth-buttons">
                <a href="profile.html" class="btn profile-btn"><i class="fa-solid fa-user"></i> Profile</a>
            </div>

        </div>
    </header>


   

<!-- Filters Section -->
<section class="filters-section">
    <div class="back-button">
        <a href="home.html"><i class="fa-solid fa-arrow-left"></i> Back to home</a>
    </div>
    <h1>Browse Movies</h1>
    <div class="filters">
    <!-- Search by title -->
    <div class="input-icon">
        <input type="text" placeholder="Search by title" class="search-title" id="filter-search">
        <i class="fa-solid fa-magnifying-glass"></i>
    </div>

    <!-- Genre -->
    <div class="select-icon">
        <select id="filter-genre">
            <option value="">Genre</option>
            <option value="Action">Action</option>
            <option value="Comedy">Comedy</option>
            <option value="Drama">Drama</option>
            <option value="Horror">Horror</option>
            <option value="Sci-Fi">Sci-Fi</option>
            <option value="Romance">Romance</option>
            <option value="Thriller">Thriller</option>
            <option value="Fantasy">Fantasy</option>
           
           
        </select>
        <i class="fa-solid fa-film"></i>
    </div>

    <!-- Rating -->
    <div class="select-icon">
        <select id="filter-rating">
            <option value="">Rating</option>
            <option value="9">9+</option>
            <option value="8">8+</option>
            <option value="7">7+</option>
            <option value="6">6+</option>
        </select>
        <i class="fa-solid fa-star"></i>
    </div>

    <!-- Year -->
    <div class="select-icon">
        <select id="filter-year">
            <option value="">Year</option>
            <option value="2025">2025</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            <option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
            <option value="2015">2015</option>
            <option value="2014">2014</option>
            <option value="2010">2010</option>
            <option value="2009">2009</option>
            <option value="2008">2008</option>
            <option value="2007">2007</option>
            <option value="1999">1999</option>
            <option value="1994">1994</option>
            <option value="1972">1972</option>
        </select>
        <i class="fa-solid fa-calendar"></i>
    </div>
</div>

</section>

<!-- Movies Grid -->
<!-- The ID 'movies-container' is vital for the JS to know where to put the movies -->
<section class="movies-grid" id="movies-container">
    <!-- Original hardcoded cards kept as per request, but JS will overwrite them on load -->
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item1.jpg" alt="Avengers: Endgame">
        <h3>Avengers: Endgame</h3>
        <p>Action | 2019</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item2.jpg" alt="The Hangover">
        <h3>The Hangover</h3>
        <p>Comedy | 2009</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item3.jpg" alt="The Godfather">
        <h3>The Godfather</h3>
        <p>Drama | 1972</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item4.jpg" alt="It">
        <h3>It</h3>
        <p>Horror | 2017</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item5.jpg" alt="Interstellar">
        <h3>Interstellar</h3>
        <p>Sci-Fi | 2014</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item6.jpg" alt="Mad Max: Fury Road">
        <h3>Mad Max: Fury Road</h3>
        <p>Action | 2015</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item7.jpg" alt="Superbad">
        <h3>Superbad</h3>
        <p>Comedy | 2007</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item8.jpg" alt="Forrest Gump">
        <h3>Forrest Gump</h3>
        <p>Drama | 1994</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item9.jpg" alt="A Quiet Place">
        <h3>A Quiet Place</h3>
        <p>Horror | 2018</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item10.jpg" alt="The Matrix">
        <h3>The Matrix</h3>
        <p>Sci-Fi | 1999</p>
    </a>
    
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item11.jpg" alt="Inception">
        <h3>Inception</h3>
        <p>Sci-Fi | 2010</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item12.jpg" alt="Joker">
        <h3>Joker</h3>
        <p>Drama | 2019</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item13.jpg" alt="Parasite">
        <h3>Parasite</h3>
        <p>Thriller | 2019</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item14.jpg" alt="The Lion King">
        <h3>The Lion King</h3>
        <p>Animation | 2019</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item15.jfif" alt="Frozen">
        <h3>Frozen</h3>
        <p>Animation | 2013</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item16.jpg" alt="Black Panther">
        <h3>Black Panther</h3>
        <p>Action | 2018</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item17.jfif" alt="The Dark Knight">
        <h3>The Dark Knight</h3>
        <p>Action | 2008</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item18.jfif" alt="Coco">
        <h3>Coco</h3>
        <p>Animation | 2017</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item19.jpeg" alt="Shutter Island">
        <h3>Shutter Island</h3>
        <p>Thriller | 2010</p>
    </a>
    <a href="movie_detail.html" class="movie-card">
        <img src="photos/mv-item20.jpg" alt="Guardians of the Galaxy">
        <h3>Guardians of the Galaxy</h3>
        <p>Action | 2014</p>
    </a>
</section>



<!-- Footer -->
<footer>
    <p>&copy; 2025 Cine Nest. All Rights Reserved.</p>
</footer>

<!-- SCRIPT: Connects Frontend to Database -->
<script>
    // 1. Fetch Movies function (Handles Filter & Search)
    function fetchMovies() {
        const search = document.getElementById('filter-search').value;
        const genre = document.getElementById('filter-genre').value;
        const rating = document.getElementById('filter-rating').value;
        const year = document.getElementById('filter-year').value;

        // Build Query URL
        const params = new URLSearchParams();
        if(search) params.append('search', search);
        if(genre) params.append('genre', genre);
        if(rating) params.append('rating', rating);
        if(year) params.append('year', year);

        fetch(`/api/movies?${params.toString()}`)
            .then(res => res.json())
            .then(movies => {
                const container = document.getElementById('movies-container');
                container.innerHTML = ''; // Clear hardcoded content

                if (movies.length === 0) {
                    container.innerHTML = '<p style="color: white; width: 100%; text-align: center;">No movies found matching criteria.</p>';
                    return;
                }

                movies.forEach(movie => {
                    // Fallback for image
                    const poster = movie.poster ? movie.poster : 'photos/default.jpg';
                    
                    // Create HTML card exactly like your design
                    // Notice we add '?id=' to the link so detail page knows which movie to show
                    const html = `
                        <a href="movie_detail.html?id=${movie.movie_id}" class="movie-card">
                            <img src="${poster}" alt="${movie.title}" onerror="this.src='photos/default.jpg'">
                            <h3>${movie.title}</h3>
                            <p>${movie.genre_name || 'Movie'} | ${movie.release_year}</p>
                        </a>
                    `;
                    container.innerHTML += html;
                });
            })
            .catch(err => console.error("Error loading movies:", err));
    }

    // 2. Event Listeners for Filters
    document.getElementById('filter-search').addEventListener('input', fetchMovies);
    document.getElementById('filter-genre').addEventListener('change', fetchMovies);
    document.getElementById('filter-rating').addEventListener('change', fetchMovies);
    document.getElementById('filter-year').addEventListener('change', fetchMovies);

    // 3. Handle Header Search Bar (Move to detail page logic not applicable here, but filtering is)
    const headerSearchBtn = document.getElementById('header-search-btn');
    const headerSearchInput = document.getElementById('header-search-input');

    if(headerSearchBtn && headerSearchInput) {
        headerSearchBtn.addEventListener('click', () => {
            const query = headerSearchInput.value.trim();
            if(query) {
                // If on movie page, just filter
                document.getElementById('filter-search').value = query;
                fetchMovies();
            }
        });
    }

    // 4. Check URL for incoming search (from Home page)
    const urlParams = new URLSearchParams(window.location.search);
    const incomingSearch = urlParams.get('search');
    if(incomingSearch) {
        document.getElementById('filter-search').value = incomingSearch;
    }

    // 5. Initial Load
    fetchMovies();

    // 6. Check Auth Status (Update Profile/Login buttons)
    fetch('/api/auth-status')
        .then(res => res.json())
        .then(data => {
            if (data.loggedIn) {
                const authDiv = document.getElementById('auth-buttons');
                if(authDiv) {
                    authDiv.innerHTML = `
                        <span style="color:white; margin-right:10px;">Hi, ${data.user.username}</span>
                        <a href="/logout" class="btn login-btn" style="background-color: #c7b7a3;color: white;">Logout</a>
                    `;
                }
            }
        });
</script>

</body>
</html>